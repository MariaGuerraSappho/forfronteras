<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For Fronterras - Musical Pitch Detector</title>
  <!-- Add Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="styles.css" />
  <!-- Import VexFlow for music notation -->
  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.1.0/build/cjs/vexflow.js"></script>
  <!-- Import RecordRTC for recording -->
  <script src="https://cdn.jsdelivr.net/npm/recordrtc@5.6.2/RecordRTC.min.js"></script>
  <!-- Import html2canvas for score export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
  <div class="app-container">
    <header>
      <img src="logo.png" alt="For Fronterras Logo" width="80" />
      <h1>For Fronterras - Duo Mode</h1>
    </header>

    <main>
      <div class="controls-section">
        <div class="input-controls">
          <label for="mic-select1">Select Microphone Player 1:</label>
          <select id="mic-select1" disabled>
            <option value="">Loading microphones...</option>
          </select>
          <button id="start-btn1" class="primary-btn">Start Listening Player 1</button>
        </div>
        <div class="input-controls">
          <label for="mic-select2">Select Microphone Player 2:</label>
          <select id="mic-select2" disabled>
            <option value="">Loading microphones...</option>
          </select>
          <button id="start-btn2" class="primary-btn">Start Listening Player 2</button>
        </div>
      </div>

      <div class="pitch-display">
        <div class="current-pitch">
          <strong>Player 1:</strong>
          <span id="detected-note1">--</span>
          <span id="detected-cents1"></span>
        </div>
        <div class="current-pitch">
          <strong>Player 2:</strong>
          <span id="detected-note2">--</span>
          <span id="detected-cents2"></span>
        </div>
      </div>

      <div class="score-container">
        <h3>Player 1 Score</h3>
        <div id="score-display1"></div>
        <div class="playback-controls">
          <button id="play-btn1" disabled>Play Player 1</button>
          <button id="next-note-btn1" disabled>Next Note Player 1</button>
          <button id="stop-btn1" disabled>Stop Player 1</button>
        </div>
      </div>

      <div class="score-container">
        <h3>Player 2 Score</h3>
        <div id="score-display2"></div>
        <div class="playback-controls">
          <button id="play-btn2" disabled>Play Player 2</button>
          <button id="next-note-btn2" disabled>Next Note Player 2</button>
          <button id="stop-btn2" disabled>Stop Player 2</button>
        </div>
      </div>

      <div class="piano-container">
        <h3>Shared Piano Keyboard (Manual Compose Mode)</h3>
        <div id="piano-keyboard"></div>
      </div>

      <div class="note-controls">
        <button id="mode-toggle-btn">Switch to Manual Compose</button>
        <button id="end-btn" class="secondary-btn" disabled>End Session</button>

        <!-- Player Select Radio Buttons Added Here -->
        <div class="player-select" style="margin-top: 1em;">
          <label><input type="radio" name="activePlayer" value="1" checked /> Player 1</label>
          <label style="margin-left: 1em;"><input type="radio" name="activePlayer" value="2" /> Player 2</label>
        </div>
      </div>

      <div class="export-section" id="export-section" style="display: none;">
        <h2>Session Complete!</h2>
        <div class="export-buttons">
          <button id="download-input-audio-btn" class="export-btn">Download Input Audio</button>
          <button id="download-sine-audio-btn" class="export-btn">Download Sine Audio</button>
          <button id="export-image-btn" class="export-btn">Export Score as Image</button>
          <button id="export-musicxml-btn" class="export-btn">Export as MusicXML</button>
        </div>
      </div>
    </main>
  </div>

  <!-- importmap and app.js as before -->
  <script type="importmap">
    {
      "imports": {
        "pitch-detector": "./pitch-detector.js",
        "tone-generator": "./tone-generator.js",
        "score-renderer": "./score-renderer.js"
      }
    }
  </script>
  <script type="module" src="app.js"></script>
</body>
</html>
